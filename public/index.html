<html>
<head>
  <title>Elemental</title>
  <link rel='stylesheet' href='style.css' type='text/css' media='all' />
</head>
<body>
  <form action="/url">
    <input type="text" name="url" value="http://google.com" />
    <input type="submit" value="Go" />
  </form>

  <p id="status"></p>
  <div id="container"></div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js" ></script>
<script>

// Set up websocket
var ws = new WebSocket('ws://{{server}}:{{port}}');

ws.onopen = function(){
  console.log('Connected to websocket.');
}

var count;
var minWidth = Infinity;
ws.onmessage = function(evt){

    var obj;
    try {
      obj = JSON.parse(evt.data);
    } catch(e){
      console.log('Had trouble decoding string: ' + evt.data);
      return;
    }

    if (obj.total){
        count = obj.total;
        updateStatus(count);
    }

    if (obj.data){
      var img = $('<img />')
        .attr('src', 'data:image/png;base64,' + obj.data)
        .appendTo('#container');

      updateStatus(count--);
    }
};

function updateStatus(count){
    $('#status')
        .text('Streaming ' + count + ' results.');
}

// Set up input box behavior
$('form').submit(function(e){

  $('#container img').remove();
  minWidth = Infinity;
  count    = undefined;

  e.preventDefault();

  var url = $(this).find('[name="url"]').val();

  ws.send(url);
  return false;
});


</script>
</body>

</html>

