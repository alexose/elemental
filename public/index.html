<html>
<head>
<title>Elemental</title>
</head>
<body>
  <form action="/url">
    <input name="url" value="http://google.com" size="80" />
    <input type="submit" />
  </form>

  <p id="status"></p>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js" ></script>
<script>

// Set up websocket
var ws = new WebSocket('ws://{{server}}:{{port}}');

ws.onopen = function(){
  console.log('Connected to websocket.');
}

var count;
ws.onmessage = function(evt){

    if (typeof(count) === 'undefined'){
        count = evt.data;
        updateStatus(count);
    } else {
        $('<img />')
          .attr('src', 'data:image/png;base64,' + evt.data)
          .appendTo('body');

         updateStatus(count--);
    }
};

function updateStatus(count){
    $('#status')
        .text('Streaming ' + count + ' results.');
}

// Set up input box behavior
$('form').submit(function(e){

  e.preventDefault();

  var url = $(this).find('[name="url"]').val();

  ws.send(url);
  return false;
});


</script>
</body>

</html>

