<html>
<head>
    <title>Elemental</title>
    <style>
    img {
        margin: 15px;
        border:  5px solid #ddd;
    }
    </style>

</head>
<body>
  <form action="/url">
    <input name="url" value="http://google.com" size="80" />
    <input type="submit" />
  </form>

  <p id="status"></p>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js" ></script>
<script>

// Set up websocket
var ws = new WebSocket('ws://{{server}}:{{port}}');

ws.onopen = function(){
  console.log('Connected to websocket.');
}

var count;
var minWidth = Infinity;
ws.onmessage = function(evt){

    if (typeof(count) === 'undefined'){
        count = evt.data;
        updateStatus(count);
    } else {
        var img = $('<img />')
          .attr('src', 'data:image/png;base64,' + evt.data)
          .hide()
          .appendTo('body');

        updateStatus(count--);

        var width = img.width();
        img.width(width);

         $('img:visible').each(function(){
            var ele = $(this)
                next = ele.next();

            if (width < minWidth){
                minWidth = width;
                ele.before(img);
            }

            if (width >= ele.width() && width <= next.width()){
              ele.after(img);
            }
         });

         img.show();
    }
};

function updateStatus(count){
    $('#status')
        .text('Streaming ' + count + ' results.');
}

// Set up input box behavior
$('form').submit(function(e){

  e.preventDefault();

  var url = $(this).find('[name="url"]').val();

  ws.send(url);
  return false;
});


</script>
</body>

</html>

